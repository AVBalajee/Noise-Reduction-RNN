(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();var z="@sapphi-red/web-noise-suppressor/noise-gate",P=class extends AudioWorkletNode{constructor(e,{openThreshold:n,closeThreshold:t=n,holdMs:s,maxChannels:o}){const a={processorOptions:{openThreshold:n,closeThreshold:t,holdMs:s,maxChannels:o}};super(e,z,a)}},S=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),f=async(e,n)=>await(await fetch(e,n)).arrayBuffer(),k=async({url:e,simdUrl:n},t)=>{const s=await S()?n:e;return await f(s,t)},N="@sapphi-red/web-noise-suppressor/rnnoise",T=class extends AudioWorkletNode{constructor(e,{maxChannels:n,wasmBinary:t}){const s={processorOptions:{maxChannels:n,wasmBinary:t}};super(e,N,s)}destroy(){this.port.postMessage("destroy")}},V=async({url:e},n)=>await f(e,n),Z="@sapphi-red/web-noise-suppressor/speex",M=class extends AudioWorkletNode{constructor(e,{maxChannels:n,wasmBinary:t}){const s={processorOptions:{maxChannels:n,wasmBinary:t}};super(e,Z,s)}destroy(){this.port.postMessage("destroy")}};const W="/assets/workletProcessor.8135a344.js",R="data:application/javascript;base64,dmFyIGQ9cj0+e2xldCBuPTA7Zm9yKGxldCBlIG9mIHIpbis9ZSplO3JldHVybiBNYXRoLnNxcnQobi9yLmxlbmd0aCl9LGY9cj0+TWF0aC5wb3coMTAsci8yMCk7dmFyIHM9e0NMT1NFRDowLE9QRU46MSxDTE9TSU5HOjJ9LHk9KHtvcGVuVGhyZXNob2xkOnIsY2xvc2VUaHJlc2hvbGQ6bixob2xkTXM6ZSxidWZmZXJNczpwfSk9PntsZXQgYT1mKHIpLGM9ZihuKSxPPU1hdGguY2VpbChlL3ApLG89cy5DTE9TRUQsaT0wO3JldHVybntuZXh0OnQ9Pntzd2l0Y2gobyl7Y2FzZSBzLkNMT1NFRDp0PmEmJihvPXMuT1BFTik7YnJlYWs7Y2FzZSBzLk9QRU46dDxjJiYobz1zLkNMT1NJTkcsaT0wKTticmVhaztjYXNlIHMuQ0xPU0lORzp0PmM/bz1zLk9QRU46aT5PP289cy5DTE9TRUQ6aSsrO2JyZWFrO2RlZmF1bHQ6Y29uc29sZS5lcnJvcihgVW5rbm93biBzdGF0ZTogJHtvfWApfX0saXNPcGVuOigpPT5vPT09cy5PUEVOfHxvPT09cy5DTE9TSU5HfX07dmFyIFM9KHtvcGVuVGhyZXNob2xkOnIsY2xvc2VUaHJlc2hvbGQ6bixob2xkTXM6ZSxtYXhDaGFubmVsczpwfSxhKT0+e2xldCBjPXkoe29wZW5UaHJlc2hvbGQ6cixjbG9zZVRocmVzaG9sZDpuLGhvbGRNczplLGJ1ZmZlck1zOmF9KTtyZXR1cm57cHJvY2VzczoobyxpKT0+e2xldCBsPU1hdGgubWluKG8ubGVuZ3RoLHApLGg9MDtmb3IobGV0IHQ9MDt0PGw7dCsrKWgrPWQob1t0XSkvbDtpZihjLm5leHQoaCksYy5pc09wZW4oKSlmb3IobGV0IHQ9MDt0PGw7dCsrKWlbdF0uc2V0KG9bdF0pfX19O3ZhciBQPSJAc2FwcGhpLXJlZC93ZWItbm9pc2Utc3VwcHJlc3Nvci9ub2lzZS1nYXRlIjt2YXIgYj0xMjgsdT1jbGFzcyBleHRlbmRzIEF1ZGlvV29ya2xldFByb2Nlc3Nvcntjb25zdHJ1Y3RvcihlKXtzdXBlcigpO2xldCBwPTFlMy9zYW1wbGVSYXRlKmI7dGhpcy5wcm9jZXNzb3I9UyhlLnByb2Nlc3Nvck9wdGlvbnMscCl9cHJvY2VzcyhlLHAsYSl7cmV0dXJuIGUubGVuZ3RoPT09MHx8IWVbMF18fGVbMF0/Lmxlbmd0aD09PTB8fHRoaXMucHJvY2Vzc29yLnByb2Nlc3MoZVswXSxwWzBdKSwhMH19O3JlZ2lzdGVyUHJvY2Vzc29yKFAsdSk7Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXdvcmtsZXRQcm9jZXNzb3IuanMubWFw",F="/assets/workletProcessor.74c98396.js",H=()=>{let e;return{async next(){return await new Promise(s=>{requestAnimationFrame(s)}),{value:void 0,done:!1}},async return(){return cancelAnimationFrame(e),{value:void 0,done:!0}},[Symbol.asyncIterator](){return this}}},L=2048,X=(e,n)=>{const t=e.getContext("2d");if(t===null)throw new Error("canvasCtx was null");const s=n.createAnalyser();s.fftSize=L;const o=new Uint8Array(s.fftSize);return(async()=>{const{height:a,width:c}=e,i=c/o.length;for await(const d of H()){s.getByteTimeDomainData(o),t.fillStyle="black",t.fillRect(0,0,c,a),t.beginPath(),t.strokeStyle="green",t.lineWidth=2;for(const[l,u]of o.entries()){const r=i*l,m=a*(u/256);l===0?t.moveTo(r,m):t.lineTo(r,m)}t.lineTo(c,a/2),t.stroke()}})(),s},B="/assets/speex.d445858b.wasm",I="/assets/rnnoise.8b60a2ab.wasm",Y="/assets/rnnoise.8b60a2ab.wasm",y=new URLSearchParams(location.search),w=y.get("sample-rate")??"NaN",h=+w,O=Number.isNaN(h)?void 0:h,J=document.querySelectorAll('[type="radio"][name="webrtc-sampleRate"]');for(const e of J)e.checked=e.value===w,e.addEventListener("click",()=>{y.set("sample-rate",e.value),location.search=y.toString()});(async()=>{const e=new AudioContext({sampleRate:O});console.log("1: Setup...");const n=await V({url:B}),t=await k({url:I,simdUrl:Y});await e.audioWorklet.addModule(W),await e.audioWorklet.addModule(R),await e.audioWorklet.addModule(F),console.log("1: Setup done");const s=document.getElementById("start-button"),o=document.getElementById("form"),a=document.getElementById("canvas"),c=X(a,e);let i,d,l,u,r;o.addEventListener("submit",async m=>{m.preventDefault(),s.disabled=!0,e.resume();const p=new FormData(o),b=p.get("type"),v=p.has("webrtc-noise"),x=p.has("webrtc-echo"),g=p.has("visualizer");console.log("2: Loading...");const G=await navigator.mediaDevices.getUserMedia({audio:{noiseSuppression:v,echoCancellation:x,autoGainControl:!1}});i?.disconnect(),i=e.createMediaStreamSource(G),console.log("2: Loaded"),console.log("3: Start"),d?.destroy(),d?.disconnect(),l?.destroy(),l?.disconnect(),u?.disconnect(),r?.disconnect(),d=new M(e,{wasmBinary:n,maxChannels:2}),l=new T(e,{wasmBinary:t,maxChannels:2}),u=new P(e,{openThreshold:-50,closeThreshold:-60,holdMs:90,maxChannels:2}),r=new GainNode(e,{gain:1}),b==="speex"?(i.connect(d),d.connect(r)):b==="rnnoise"?(i.connect(l),l.connect(r)):b==="noiseGate"?(i.connect(u),u.connect(r)):i.connect(r),c.disconnect(),g&&r.connect(c),r.connect(e.destination),s.disabled=!1}),s.disabled=!1})();
