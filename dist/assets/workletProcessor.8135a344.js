var P=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(i,e)=>(typeof require<"u"?require:i)[e]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var x={};var b=(r=>typeof P<"u"?P:typeof Proxy<"u"?new Proxy(r,{get:(i,e)=>(typeof P<"u"?P:i)[e]}):r)(function(r){if(typeof P<"u")return P.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')}),n={SET_DENOISE:0,GET_DENOISE:1,SET_AGC:2,GET_AGC:3,SET_VAD:4,GET_VAD:5,SET_AGC_LEVEL:6,GET_AGC_LEVEL:7,SET_PROB_START:14,GET_PROB_START:15,SET_PROB_CONTINUE:16,GET_PROB_CONTINUE:17,SET_NOISE_SUPPRESS:18,GET_NOISE_SUPPRESS:19,SET_ECHO_SUPPRESS:20,GET_ECHO_SUPPRESS:21,SET_ECHO_SUPPRESS_ACTIVE:22,GET_ECHO_SUPPRESS_ACTIVE:23,SET_AGC_INCREMENT:26,GET_AGC_INCREMENT:27,SET_AGC_DECREMENT:28,GET_AGC_DECREMENT:29,SET_AGC_MAX_GAIN:30,GET_AGC_MAX_GAIN:31,GET_AGC_LOUDNESS:33,GET_AGC_GAIN:35,GET_PSD_SIZE:37,GET_PSD:39,GET_NOISE_PSD_SIZE:41,GET_NOISE_PSD:43,GET_PROB:45,SET_AGC_TARGET:46,GET_AGC_TARGET:47},ae=Int16Array.BYTES_PER_ELEMENT,U=Int32Array.BYTES_PER_ELEMENT,ce=Float32Array.BYTES_PER_ELEMENT,ue=2**16/2-1,fe=class{constructor(r,i,e){if(this.speexModule=r,this.frameSize=i,this.samplingRate=e,this.state=this.speexModule._speex_preprocess_state_init(this.frameSize,this.samplingRate),this.processBuffPtr=this.speexModule._malloc(this.frameSize*ae),this.processI16Buff=new Int16Array(this.frameSize),!this.processBuffPtr)throw this.destroy(),Error("Failed to allocate process buffer.")}mallocCtlBuffPtr(){if(this.ctlBuffPtr===void 0&&(this.ctlBuffPtr=this.speexModule._malloc(4),!this.ctlBuffPtr))throw Error("Failed to allocate ctl buffer.")}ctl(r,i){if(this.speexModule._speex_preprocess_ctl(this.state,r,i)===-1)throw new Error(`Unknown request: ${r}`)}ctlGetI32(r){this.mallocCtlBuffPtr();let i=this.ctlBuffPtr/U;return this.ctl(r,this.ctlBuffPtr),this.speexModule.HEAP32[i]}ctlSetI32(r,i){this.mallocCtlBuffPtr();let e=this.ctlBuffPtr/U;this.speexModule.HEAP32[e]=i,this.ctl(r,this.ctlBuffPtr)}ctlGetBool(r){return this.ctlGetI32(r)===1}ctlSetBool(r,i){this.ctlSetI32(r,i?1:0)}ctlGetF32(r){this.mallocCtlBuffPtr();let i=this.ctlBuffPtr/ce;return this.ctl(r,this.ctlBuffPtr),this.speexModule.HEAPF32[i]}ctlSetF32(r,i){this.mallocCtlBuffPtr();let e=this.ctlBuffPtr/ce;this.speexModule.HEAPF32[e]=i,this.ctl(r,this.ctlBuffPtr)}ctlGetI32Array(r,i){let e=this.speexModule._malloc(i*U),_=e/U;this.ctl(r,e);let p=new Int32Array(i),g=this.speexModule.HEAP32.subarray(_,_+i);return p.set(g),this.speexModule._free(e),p}get denoise(){return this.ctlGetBool(n.GET_DENOISE)}set denoise(r){this.ctlSetBool(n.SET_DENOISE,r)}get agc(){return this.ctlGetBool(n.GET_AGC)}set agc(r){this.ctlSetBool(n.SET_AGC,r)}get vad(){return this.ctlGetBool(n.GET_VAD)}set vad(r){this.ctlSetBool(n.SET_VAD,r)}get agcLevel(){return this.ctlGetF32(n.GET_AGC_LEVEL)}set agcLevel(r){this.ctlSetF32(n.SET_AGC_LEVEL,r)}get probStart(){return this.ctlGetI32(n.GET_PROB_START)}set probStart(r){this.ctlSetI32(n.SET_PROB_START,r)}get probContinue(){return this.ctlGetI32(n.GET_PROB_CONTINUE)}set probContinue(r){this.ctlSetI32(n.SET_PROB_CONTINUE,r)}get noiseSuppress(){return this.ctlGetI32(n.GET_NOISE_SUPPRESS)}set noiseSuppress(r){this.ctlSetI32(n.SET_NOISE_SUPPRESS,r)}get echoSuppress(){return this.ctlGetI32(n.GET_ECHO_SUPPRESS)}set echoSuppress(r){this.ctlSetI32(n.SET_ECHO_SUPPRESS,r)}get echoSuppressActive(){return this.ctlGetI32(n.GET_ECHO_SUPPRESS_ACTIVE)}set echoSuppressActive(r){this.ctlSetI32(n.SET_ECHO_SUPPRESS_ACTIVE,r)}get agcIncrement(){return this.ctlGetI32(n.GET_AGC_INCREMENT)}set agcIncrement(r){this.ctlSetI32(n.SET_AGC_INCREMENT,r)}get agcDecrement(){return this.ctlGetI32(n.GET_AGC_DECREMENT)}set agcDecrement(r){this.ctlSetI32(n.SET_AGC_DECREMENT,r)}get agcMaxGain(){return this.ctlGetI32(n.GET_AGC_MAX_GAIN)}set agcMaxGain(r){this.ctlSetI32(n.SET_AGC_MAX_GAIN,r)}get agcLoudness(){return this.ctlGetI32(n.GET_AGC_LOUDNESS)}get agcGain(){return this.ctlGetI32(n.GET_AGC_GAIN)}get psdSize(){return this.ctlGetI32(n.GET_PSD_SIZE)}get psd(){return this.ctlGetI32Array(n.GET_PSD,this.psdSize)}get noisePsdSize(){return this.ctlGetI32(n.GET_NOISE_PSD_SIZE)}get noisePsd(){return this.ctlGetI32Array(n.GET_NOISE_PSD,this.noisePsdSize)}get prob(){return this.ctlGetI32(n.GET_PROB)}get agcTarget(){return this.ctlGetI32(n.GET_AGC_TARGET)}set agcTarget(r){this.ctlSetI32(n.SET_AGC_TARGET,r)}assertFrameSize(r){if(r.length!==this.frameSize)throw new Error(`Frame size differs. Expected: ${this.frameSize}. Actual: ${r.length}.`)}processInt16(r){this.assertFrameSize(r);let i=this.processBuffPtr/ae;this.speexModule.HEAP16.set(r,i);let e=this.speexModule._speex_preprocess_run(this.state,this.processBuffPtr),_=this.speexModule.HEAP16.subarray(i,i+this.frameSize);return r.set(_),e===1}process(r){this.assertFrameSize(r);for(let e=0;e<r.length;e++)this.processI16Buff[e]=r[e]*ue;let i=this.processInt16(this.processI16Buff);for(let e=0;e<r.length;e++)r[e]=this.processI16Buff[e]/ue;return i}destroy(){this.speexModule._free(this.processBuffPtr),this.ctlBuffPtr!==void 0&&this.speexModule._free(this.ctlBuffPtr)}},nt=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(e){e=e||{};var e=typeof e<"u"?e:{},_,p;e.ready=new Promise(function(t,s){_=t,p=s});var g=Object.assign({},e),B=[],D="./this.program",F=(t,s)=>{throw s},E=typeof x=="object",m=typeof importScripts=="function",A=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",u="";function Ee(t){return e.locateFile?e.locateFile(t,u):u+t}var H,C,w,de;function he(t){if(t instanceof ne)return;T("exiting due to exception: "+t)}if(A){m?u=b("path").dirname(u)+"/":u=__dirname+"/";var L,W;typeof b=="function"&&(L=b("fs"),W=b("path")),H=(t,s)=>(t=W.normalize(t),L.readFileSync(t,s?void 0:"utf8")),w=t=>{var s=H(t,!0);return s.buffer||(s=new Uint8Array(s)),s},C=(t,s,a)=>{t=W.normalize(t),L.readFile(t,function(c,f){c?a(c):s(f.buffer)})},process.argv.length>1&&(D=process.argv[1].replace(/\\/g,"/")),B=process.argv.slice(2),process.on("uncaughtException",function(t){if(!(t instanceof ne))throw t}),process.on("unhandledRejection",function(t){throw t}),F=(t,s)=>{if(xe())throw process.exitCode=t,s;he(s),process.exit(t)},e.inspect=function(){return"[Emscripten Module object]"}}else(E||m)&&(m?u=self.location.href:typeof document<"u"&&document.currentScript&&(u=document.currentScript.src),r&&(u=r),u.indexOf("blob:")!==0?u=u.substr(0,u.replace(/[?#].*/,"").lastIndexOf("/")+1):u="",H=t=>{var s=new XMLHttpRequest;return s.open("GET",t,!1),s.send(null),s.responseText},m&&(w=t=>{var s=new XMLHttpRequest;return s.open("GET",t,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),C=(t,s,a)=>{var c=new XMLHttpRequest;c.open("GET",t,!0),c.responseType="arraybuffer",c.onload=()=>{if(c.status==200||c.status==0&&c.response){s(c.response);return}a()},c.onerror=a,c.send(null)},de=t=>document.title=t);var Se=e.print||console.log.bind(console),T=e.printErr||console.warn.bind(console);Object.assign(e,g),g=null,e.arguments&&(B=e.arguments),e.thisProgram&&(D=e.thisProgram),e.quit&&(F=e.quit);var v;e.wasmBinary&&(v=e.wasmBinary);var me=e.noExitRuntime||!0;typeof WebAssembly!="object"&&k("no native wasm support detected");var M,X=!1,Te,Y=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function j(t,s,a){for(var c=s+a,f=s;t[f]&&!(f>=c);)++f;if(f-s>16&&t.buffer&&Y)return Y.decode(t.subarray(s,f));for(var h="";s<f;){var o=t[s++];if(!(o&128)){h+=String.fromCharCode(o);continue}var l=t[s++]&63;if((o&224)==192){h+=String.fromCharCode((o&31)<<6|l);continue}var S=t[s++]&63;if((o&240)==224?o=(o&15)<<12|l<<6|S:o=(o&7)<<18|l<<12|S<<6|t[s++]&63,o<65536)h+=String.fromCharCode(o);else{var I=o-65536;h+=String.fromCharCode(55296|I>>10,56320|I&1023)}}return h}function ye(t,s){return t?j(G,t,s):""}var K,Pe,G,Ae,Ie,Z,N,ge,ve;function $(t){K=t,e.HEAP8=Pe=new Int8Array(t),e.HEAP16=Ae=new Int16Array(t),e.HEAP32=Z=new Int32Array(t),e.HEAPU8=G=new Uint8Array(t),e.HEAPU16=Ie=new Uint16Array(t),e.HEAPU32=N=new Uint32Array(t),e.HEAPF32=ge=new Float32Array(t),e.HEAPF64=ve=new Float64Array(t)}var ot=e.INITIAL_MEMORY||16777216,Ge,J=[],Q=[],ee=[],Re=!1;function xe(){return me}function Be(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)Me(e.preRun.shift());V(J)}function Ce(){Re=!0,V(Q)}function we(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)Oe(e.postRun.shift());V(ee)}function Me(t){J.unshift(t)}function Ne(t){Q.unshift(t)}function Oe(t){ee.unshift(t)}var y=0,z=null,R=null;function be(t){y++,e.monitorRunDependencies&&e.monitorRunDependencies(y)}function Ue(t){if(y--,e.monitorRunDependencies&&e.monitorRunDependencies(y),y==0&&(z!==null&&(clearInterval(z),z=null),R)){var s=R;R=null,s()}}function k(t){e.onAbort&&e.onAbort(t),t="Aborted("+t+")",T(t),X=!0,Te=1,t+=". Build with -sASSERTIONS for more info.";var s=new WebAssembly.RuntimeError(t);throw p(s),s}var De="data:application/octet-stream;base64,";function te(t){return t.startsWith(De)}function re(t){return t.startsWith("file://")}var d;d="speex.wasm",te(d)||(d=Ee(d));function se(t){try{if(t==d&&v)return new Uint8Array(v);if(w)return w(t);throw"both async and sync fetching of the wasm failed"}catch(s){k(s)}}function Fe(){if(!v&&(E||m)){if(typeof fetch=="function"&&!re(d))return fetch(d,{credentials:"same-origin"}).then(function(t){if(!t.ok)throw"failed to load wasm binary file at '"+d+"'";return t.arrayBuffer()}).catch(function(){return se(d)});if(C)return new Promise(function(t,s){C(d,function(a){t(new Uint8Array(a))},s)})}return Promise.resolve().then(function(){return se(d)})}function He(){var t={a:Ke};function s(o,l){var S=o.exports;e.asm=S,M=e.asm.f,$(M.buffer),Ge=e.asm.n,Ne(e.asm.g),Ue("wasm-instantiate")}be("wasm-instantiate");function a(o){s(o.instance)}function c(o){return Fe().then(function(l){return WebAssembly.instantiate(l,t)}).then(function(l){return l}).then(o,function(l){T("failed to asynchronously prepare wasm: "+l),k(l)})}function f(){return!v&&typeof WebAssembly.instantiateStreaming=="function"&&!te(d)&&!re(d)&&!A&&typeof fetch=="function"?fetch(d,{credentials:"same-origin"}).then(function(o){var l=WebAssembly.instantiateStreaming(o,t);return l.then(a,function(S){return T("wasm streaming compile failed: "+S),T("falling back to ArrayBuffer instantiation"),c(a)})}):c(a)}if(e.instantiateWasm)try{var h=e.instantiateWasm(t,s);return h}catch(o){T("Module.instantiateWasm callback failed with error: "+o),p(o)}return f().catch(p),{}}function ne(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function V(t){for(;t.length>0;)t.shift()(e)}function Le(t,s,a){G.copyWithin(t,s,s+a)}function We(){return 2147483648}function ze(t){try{return M.grow(t-K.byteLength+65535>>>16),$(M.buffer),1}catch{}}function ke(t){var s=G.length;t=t>>>0;var a=We();if(t>a)return!1;let c=(S,I)=>S+(I-S%I)%I;for(var f=1;f<=4;f*=2){var h=s*(1+.2/f);h=Math.min(h,t+100663296);var o=Math.min(a,c(Math.max(t,h),65536)),l=ze(o);if(l)return!0}return!1}var ie={varargs:void 0,get:function(){ie.varargs+=4;var t=Z[ie.varargs-4>>2];return t},getStr:function(t){var s=ye(t);return s}};function Ve(t){return 52}function qe(t,s,a,c,f){return 70}var Xe=[null,[],[]];function Ye(t,s){var a=Xe[t];s===0||s===10?((t===1?Se:T)(j(a,0)),a.length=0):a.push(s)}function je(t,s,a,c){for(var f=0,h=0;h<a;h++){var o=N[s>>2],l=N[s+4>>2];s+=8;for(var S=0;S<l;S++)Ye(t,G[o+S]);f+=l}return N[c>>2]=f,0}var Ke={d:Le,e:ke,c:Ve,b:qe,a:je},at=He(),Ze=e.___wasm_call_ctors=function(){return(Ze=e.___wasm_call_ctors=e.asm.g).apply(null,arguments)},$e=e._speex_preprocess_state_init=function(){return($e=e._speex_preprocess_state_init=e.asm.h).apply(null,arguments)},Je=e._speex_preprocess_state_destroy=function(){return(Je=e._speex_preprocess_state_destroy=e.asm.i).apply(null,arguments)},Qe=e._speex_preprocess_run=function(){return(Qe=e._speex_preprocess_run=e.asm.j).apply(null,arguments)},et=e._speex_preprocess_ctl=function(){return(et=e._speex_preprocess_ctl=e.asm.k).apply(null,arguments)},tt=e._malloc=function(){return(tt=e._malloc=e.asm.l).apply(null,arguments)},rt=e._free=function(){return(rt=e._free=e.asm.m).apply(null,arguments)},O;R=function t(){O||oe(),O||(R=t)};function oe(t){if(t=t||B,y>0||(Be(),y>0))return;function s(){O||(O=!0,e.calledRun=!0,!X&&(Ce(),_(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),we()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),s()},1)):s()}if(e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return oe(),e.ready}})(),le=nt;var pe=(r,{bufferSize:i,maxChannels:e,sampleRate:_})=>{let p=Array.from({length:e},()=>new fe(r,i,_));for(let E of p)E.denoise=!0;return{process:(E,m)=>{let A=Math.min(E.length,e);for(let u=0;u<A;u++)p[u].process(E[u]),m[u].set(E[u])},getProperty:E=>p[0][E],setProperty:(E,m)=>{for(let A of p)A[E]=m},destroy:()=>{for(let E of p)E.destroy()}}};var _e="@sapphi-red/web-noise-suppressor/speex";var it=128,q=class extends AudioWorkletProcessor{constructor(e){super();this.destroyed=!1;this.port.addEventListener("message",_=>{_.data==="destroy"&&this.destroy()}),(async()=>{let _=await le({locateFile:p=>p,wasmBinary:e.processorOptions.wasmBinary});this.processor=pe(_,{bufferSize:it,maxChannels:e.processorOptions.maxChannels,sampleRate}),this.destroyed&&this.destroy()})()}process(e,_,p){return e.length===0||!e[0]||e[0]?.length===0||!this.processor||this.processor.process(e[0],_[0]),!0}destroy(){this.destroyed=!0,this.processor?.destroy(),this.processor=void 0}};registerProcessor(_e,q);
/*!
license of speex.wasm

---

Copyright 2002-2008 	Xiph.org Foundation
Copyright 2002-2008 	Jean-Marc Valin
Copyright 2005-2007	Analog Devices Inc.
Copyright 2005-2008	Commonwealth Scientific and Industrial Research
                        Organisation (CSIRO)
Copyright 1993, 2002, 2006 David Rowe
Copyright 2003 		EpicGames
Copyright 1992-1994	Jutta Degener, Carsten Bormann

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:

- Redistributions of source code must retain the above copyright
notice, this list of conditions and the following disclaimer.

- Redistributions in binary form must reproduce the above copyright
notice, this list of conditions and the following disclaimer in the
documentation and/or other materials provided with the distribution.

- Neither the name of the Xiph.org Foundation nor the names of its
contributors may be used to endorse or promote products derived from
this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
//# sourceMappingURL=workletProcessor.js.map